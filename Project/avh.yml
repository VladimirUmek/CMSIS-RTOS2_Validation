name: "RTOS2 Validation"
workdir: ../
backend:
  aws:
    ami-version: ~=1.3
    instance-type: t2.micro
upload:
  - README.md
  - Include/**/*
  - Layer/**/*
  - Project/**/*
  - -:Project/Validation-*.zip
  - -:Project/Validation-*.junit
  - -:Project/Validation.*/**/*
  - Source/**/*
steps:
  - run: |
      echo "PWD : $(pwd)"
      cd Project
      pip install -r requirements.txt 2>&1 || exit 1
      . <(curl https://aka.ms/vcpkg-init.sh -L)
      vcpkg activate --project vcpkg-configuration.json

      echo "AC6       : $(which armclang)"
      echo "GCC       : $(which arm-none-eabi-gcc)"
      echo "cbuild    : $(which cbuild)"
      echo "cpackget  : $(which cpackget)"
      echo "csolution : $(which csolution)"
      printenv

      cpackget update-index 2>&1
      cpackget add -a -f cpacklist.txt 2>&1
      python build.py --verbose build run 2>&1 || echo "Something failed!"
download:
  - Project/Validation-*.zip
  - Project/Validation-*.junit
